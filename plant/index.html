<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Iroko Ewé Knowledge Explorer: stewardship-centered linked data for ethically governed ethnobotanical knowledge.">  
  <title>Plants | Iroko Ewé Knowledge Explorer</title>
  <link rel="stylesheet" href="/iroko-ewe-explorer/assets/style.css">
  <style>
    .lang-panel { display: none; }
    .lang-panel.active { display: block; }
  
    .top-nav {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
      margin: 10px 0 22px 0;
    }
    .top-nav a {
      text-decoration: none;
      font-weight: 600;
    }
  </style>
  <script src="https://unpkg.com/n3@1.20.0/browser/n3.min.js"></script>
</head>

<body>

<header class="iroko-header">
  <div class="header-inner">

    <div class="logo-block">
      <a href="/iroko-ewe-explorer/index.html" aria-label="Return to Homepage">
        <img src="/iroko-ewe-explorer/assets/IHS-Logo.jpg" alt="Iroko Historical Society Logo">
      </a>
    </div>
    
    <div class="header-text">
      <h1>Iroko Ewé Knowledge Explorer</h1>
      <p class="subtitle">Linked Data for Ethically Governed Ethnobotanical Knowledge</p>
      <div class="version-pill">Version 0.2.1 | February 2026</div>

      <div class="lang-buttons" aria-label="Language selector">
        <button type="button" onclick="setLang('en')" id="btn-en">English</button>
        <button type="button" onclick="setLang('es')" id="btn-es">Español</button>
        <button type="button" onclick="setLang('pt')" id="btn-pt">Português</button>
        <button type="button" onclick="setLang('fr')" id="btn-fr">Français</button>
        <button type="button" onclick="setLang('yo')" id="btn-yo">Èdè Yorùbá</button>
      </div>

    </div>
  </div>
</header>

<nav class="top-nav">
  <a href="/iroko-ewe-explorer/index.html">Home</a>
  <a href="/iroko-ewe-explorer/concept/index.html">Controlled Vocabularies</a>
</nav>

<!-- EN -->
<section id="panel-en" class="lang-panel active">
  <h2>Plant Records</h2>

  <p>
    Plant records in this Explorer are structured knowledge nodes within the Iroko Framework.
    Each record integrates botanical classification, multilingual naming traditions,
    and governance-aware metadata.
  </p>

  <p>
    When the dataset is published, each plant page will display:
  </p>

  <ul>
    <li><strong>Yorùbá name</strong> (set alphabetical; primary form not asserted)</li>
    <li>Scientific name (taxonomic reference)</li>
    <li>Multilingual alternate names</li>
    <li>Access level classification</li>
    <li>Medicinal categories</li>
    <li>Ritual categories</li>
    <li>Provenance and external references</li>
  </ul>

  <p>
    Where applicable, plant records may also link to preserved specimens and herbarium records
    modeled using Darwin Core occurrence standards.
  </p>

  <h3>Preview (from data/ewe-plants-v0.2.1.ttl)</h3>
  <p class="muted">Loading plant list…</p>
  <div id="plant-list-en"></div>
</section>

<!-- ES -->
<section id="panel-es" class="lang-panel">
  <h2>Registros de plantas</h2>

  <p>
    Los registros de plantas en este Explorador son nodos de conocimiento estructurados dentro del Iroko Framework.
    Cada registro integra clasificación botánica, tradiciones multilingües de denominación
    y metadatos con gobernanza explícita.
  </p>

  <p>
    Cuando se publique el conjunto de datos, cada página de planta mostrará:
  </p>

  <ul>
    <li><strong>Conjunto de nombres en yorùbá</strong> (orden alfabético; no se afirma una forma primaria)</li>
    <li>Nombre científico (referencia taxonómica)</li>
    <li>Nombres alternativos multilingües</li>
    <li>Clasificación del nivel de acceso</li>
    <li>Categorías medicinales</li>
    <li>Categorías rituales</li>
    <li>Procedencia y referencias externas</li>
  </ul>

  <p>
    Cuando corresponda, los registros podrán enlazar a especímenes preservados y registros de herbario
    modelados con estándares Darwin Core para ocurrencias.
  </p>

  <p><em>Todavía no se han publicado registros de plantas.</em></p>
</section>

<!-- PT -->
<section id="panel-pt" class="lang-panel">
  <h2>Registros de plantas</h2>

  <p>
    Os registros de plantas neste Explorador são nós de conhecimento estruturados dentro do Iroko Framework.
    Cada registro integra classificação botânica, tradições multilíngues de nomeação
    e metadados com governança explícita.
  </p>

  <p>
    Quando o conjunto de dados for publicado, cada página de planta exibirá:
  </p>

  <ul>
    <li><strong>Conjunto de nomes em yorùbá</strong> (ordem alfabética; nenhuma forma primária é afirmada)</li>
    <li>Nome científico (referência taxonômica)</li>
    <li>Nomes alternativos multilíngues</li>
    <li>Classificação do nível de acesso</li>
    <li>Categorias medicinais</li>
    <li>Categorias rituais</li>
    <li>Proveniência e referências externas</li>
  </ul>

  <p>
    Quando aplicável, os registros poderão vincular a espécimes preservados e registros de herbário
    modelados com padrões Darwin Core para ocorrências.
  </p>

  <p><em>Ainda não há registros de plantas publicados.</em></p>
</section>

<!-- FR -->
<section id="panel-fr" class="lang-panel">
  <h2>Notices de plantes</h2>

  <p>
    Les notices de plantes dans cet Explorateur sont des nœuds de connaissance structurés au sein du Iroko Framework.
    Chaque notice intègre une classification botanique, des traditions multilingues de nomination
    et des métadonnées à gouvernance explicite.
  </p>

  <p>
    Une fois le jeu de données publié, chaque page de plante affichera :
  </p>

  <ul>
    <li><strong>Ensemble des noms en yorùbá</strong> (ordre alphabétique ; aucune forme primaire n’est affirmée)</li>
    <li>Nom scientifique (référence taxonomique)</li>
    <li>Noms alternatifs multilingues</li>
    <li>Classification du niveau d’accès</li>
    <li>Catégories médicinales</li>
    <li>Catégories rituelles</li>
    <li>Provenance et références externes</li>
  </ul>

  <p>
    Le cas échéant, les notices pourront renvoyer à des spécimens conservés et à des notices d’herbier,
    modélisés selon les standards Darwin Core (occurrences).
  </p>

  <p><em>Aucune notice de plante n’a encore été publiée.</em></p>
</section>

<!-- YO -->
<section id="panel-yo" class="lang-panel">
  <h2>Àwọn àkọsílẹ̀ ọgbìn</h2>

  <p>
    Àwọn àkọsílẹ̀ ọgbìn nínú Explorer yìí jẹ́ “nódù” ìmọ̀ tí a ṣètò lábẹ́ Iroko Framework.
    Àkọsílẹ̀ kọọkan ń darapọ̀ ìpín ọgbìn (botanical classification), àṣà orúkọ ní ọ̀pọ̀ èdè,
    àti metadátà pẹ̀lú ìṣàkóso tó hàn gbangba.
  </p>

  <p>
    Nígbà tí a bá tẹ̀ dataset jáde, ojú-ewé ọgbìn kọọkan yóò fi hàn:
  </p>

  <ul>
    <li><strong>Àkójọpọ̀ àwọn orúkọ Yorùbá</strong> (ní títò lẹ́sẹ̀sẹ̀ àlùfábẹ́ẹ̀tì; a kò fi ọ̀kan kàn hàn gẹ́gẹ́ bí orúkọ àkọ́kọ́)</li>
    <li>Orúkọ sáyẹ́ǹsì (ìtọ́kasí taxon)</li>
    <li>Àwọn orúkọ míì ní ọ̀pọ̀ èdè</li>
    <li>Ìpele àyèwọ̀lé</li>
    <li>Àwọn ẹ̀ka ìwòsàn</li>
    <li>Àwọn ẹ̀ka ìṣe-ẹ̀mí</li>
    <li>Provenance àti àwọn ìtọ́kasí òde</li>
  </ul>

  <p>
    Níbi tó bá yẹ, àkọsílẹ̀ ọgbìn lè so mọ́ “preserved specimen” àti àkọsílẹ̀ herbarium
    tí a ṣe pẹ̀lú ìlànà Darwin Core (occurrence).
  </p>

  <p><em>Kò tíì sí àkọsílẹ̀ ọgbìn tí a tẹ̀ jáde.</em></p>
</section>


<footer class="footer">
  <a href="/iroko-ewe-explorer/index.html">← Back to Home</a>
</footer>

<script>
  function setLang(lang) {
    const panels = document.querySelectorAll(".lang-panel");
    const buttons = document.querySelectorAll(".lang-buttons button");

    panels.forEach(p => p.classList.remove("active"));
    buttons.forEach(b => b.classList.remove("active"));

    const panel = document.getElementById("panel-" + lang);
    const btn = document.getElementById("btn-" + lang);

    if (panel) panel.classList.add("active");
    if (btn) btn.classList.add("active");

    document.documentElement.lang = lang;

    try { localStorage.setItem("iroko_lang", lang); } catch(e) {}
  }

  (function init() {
    let saved = "en";
    try { saved = localStorage.getItem("iroko_lang") || "en"; } catch(e) {}
    setLang(saved);
  })();
</script>
  
<script>
  async function fetchText(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Could not load " + url + " (HTTP " + res.status + ")");
    return await res.text();
  }

  function pickByLang(map, lang) {
    const order = [lang, "en", "yo", "es", "pt", "fr"];
    for (const l of order) {
      if (map[l] && map[l].length) return map[l];
    }
    return [];
  }

  async function loadPlantsGraph() {
    const statusEl = document.querySelector("#panel-en .muted");
    const listEl = document.getElementById("plant-list-en");

    const PLANTS_TTL = "../data/ewe-plants-v0.2.1.ttl";
    const VOCAB_TTL  = "../data/iroko-vocab-v0.2.1.ttl";

    try {
      const [plantsText, vocabText] = await Promise.all([
        fetchText(PLANTS_TTL),
        fetchText(VOCAB_TTL)
      ]);

      const parser = new N3.Parser();
      const quads = parser.parse(plantsText + "\n\n" + vocabText);

      // URIs
      const RDF_TYPE = "http://www.w3.org/1999/02/22-rdf-syntax-ns#type";
      const SKOS_PREF = "http://www.w3.org/2004/02/skos/core#prefLabel";
      const SKOS_ALT  = "http://www.w3.org/2004/02/skos/core#altLabel";

      const DCT_ID = "http://purl.org/dc/terms/identifier";
      const DCT_SOURCE = "http://purl.org/dc/terms/source";
      const DCT_REL = "http://purl.org/dc/terms/relation";

      const DWC_SCI = "http://rs.tdwg.org/dwc/terms/scientificName";

      const IROKO_PLANT = "https://iroko-framework.org/ewe/Plant";
      const IROKO_ACCESS = "https://iroko-framework.org/ewe/hasAccessLevel";
      const IROKO_MED = "https://iroko-framework.org/ewe/hasMedicinalCategory";
      const IROKO_RIT = "https://iroko-framework.org/ewe/hasRitualCategory";

      const IROKO_COLLISION_FLAG = "https://iroko-framework.org/ewe/nameCollisionFlag";
      const IROKO_COLLISION_NOTE = "https://iroko-framework.org/ewe/nameCollisionNote";
      const IROKO_RITUAL_NOTE = "https://iroko-framework.org/ewe/ritualContextNote";

      const DWC_SCI_SYN = "http://rs.tdwg.org/dwc/terms/scientificNameSynonym";

      // Concept labels: URI -> { lang: [labels...] }
      const conceptLabels = new Map();

      // Records
      const bySubject = new Map();
      const plantSubjects = new Set();

      for (const q of quads) {
        const s = q.subject.value;
        const p = q.predicate.value;
        const o = q.object;

        // Collect SKOS prefLabels into concept label map (for URI resolution)
        // AND into altByLang on the subject record so plant prefLabels render
        if (p === SKOS_PREF && o.termType === "Literal") {
          const lang = (o.language || "en").toLowerCase();
          if (!conceptLabels.has(s)) conceptLabels.set(s, {});
          const m = conceptLabels.get(s);
          if (!m[lang]) m[lang] = [];
          m[lang].push(o.value);
          // Also store on the record so plant-level prefLabels appear in name display
          if (!bySubject.has(s)) bySubject.set(s, { uri: s, id: null, sci: null, altByLang: {}, prefByLang: {}, nameListMethod: null, collisionFlag: null, collisionNoteByLang: {}, ritualNoteByLang: {}, access: [], medicinal: [], ritual: [], source: [], sourceUris: [], links: [] });
          const rec2 = bySubject.get(s);
          if (!rec2.prefByLang) rec2.prefByLang = {};
          if (!rec2.prefByLang[lang]) rec2.prefByLang[lang] = [];
          rec2.prefByLang[lang].push(o.value);
        }

        // Track plant type
        if (p === RDF_TYPE && o.value === IROKO_PLANT) {
          plantSubjects.add(s);
        }

        if (!bySubject.has(s)) {
          bySubject.set(s, {
            uri: s,
            id: null,
            sci: null,
            altByLang: {},
            prefByLang: {},

            collisionFlag: null,
            collisionNoteByLang: {},
            ritualNoteByLang: {},

            access: [],
            medicinal: [],
            ritual: [],

            source: [],
            sourceUris: [],
            links: []
          });
        }

        const rec = bySubject.get(s);

        if (p === DCT_ID && o.termType === "Literal") rec.id = o.value;
        if (p === DWC_SCI && o.termType === "Literal") rec.sci = o.value;

        if (p === SKOS_ALT && o.termType === "Literal") {
          const lang = (o.language || "und").toLowerCase();
          if (!rec.altByLang[lang]) rec.altByLang[lang] = [];
          rec.altByLang[lang].push(o.value);
        }

        if (p === IROKO_COLLISION_FLAG && o.termType === "Literal") rec.collisionFlag = o.value;

        if (p === IROKO_COLLISION_NOTE && o.termType === "Literal") {
          const lang = (o.language || "en").toLowerCase();
          if (!rec.collisionNoteByLang[lang]) rec.collisionNoteByLang[lang] = [];
          rec.collisionNoteByLang[lang].push(o.value);
        }

        if (p === IROKO_RITUAL_NOTE && o.termType === "Literal") {
          const lang = (o.language || "en").toLowerCase();
          if (!rec.ritualNoteByLang[lang]) rec.ritualNoteByLang[lang] = [];
          rec.ritualNoteByLang[lang].push(o.value);
        }

        if (p === IROKO_ACCESS && o.termType === "NamedNode") rec.access.push(o.value);
        if (p === IROKO_MED && o.termType === "NamedNode") rec.medicinal.push(o.value);
        if (p === IROKO_RIT && o.termType === "NamedNode") rec.ritual.push(o.value);

        if (p === DCT_SOURCE && o.termType === "Literal") rec.source.push(o.value);
        if (p === DCT_SOURCE && o.termType === "NamedNode") rec.sourceUris.push(o.value);

        // Collect bibliographicCitation so bib nodes can be resolved for source display
        const DCT_BIB_URI = "http://purl.org/dc/terms/bibliographicCitation";
        if (p === DCT_BIB_URI && o.termType === "Literal") rec.source.push(o.value);
        if (p === DCT_REL) rec.links.push(o.value);
      }

      // Resolve concept label (in the page language, with fallback)
      function labelize(uri, lang) {
        const m = conceptLabels.get(uri);
        if (m) {
          const chosen = pickByLang(m, lang);
          if (chosen.length) return chosen[0];
        }
        return uri.split("/").pop();
      }

      const pageLang = "en"; // we can later bind this to the active panel
      const plants = Array.from(plantSubjects)
        .map(u => bySubject.get(u))
        .filter(Boolean)
        .sort((a,b) => (a.sci || "").localeCompare(b.sci || ""));

      if (statusEl) statusEl.textContent = "Loaded " + plants.length + " plant record(s) (plants + vocab).";
      listEl.innerHTML = "";

      if (!plants.length) {
        listEl.innerHTML = "<p><em>No iroko:Plant records found.</em></p>";
        return;
      }

      for (const p of plants) {
        const yo = (p.altByLang["yo"] || []).concat(p.prefByLang?.["yo"] || []).filter((v,i,a)=>a.indexOf(v)===i).join("; ") || "—";
        const enAlt = (p.altByLang["en"] || []).join("; ") || "—";
        const lucumiAlt = (p.altByLang["yo-x-lucumi"] || []).join("; ");
        const esCuAlt = (p.altByLang["es-cu"] || []).join("; ");
        const esAlt = (p.altByLang["es"] || []).filter(v => !esCuAlt.includes(v)).join("; ");
        const htAlt = (p.altByLang["ht"] || []).join("; ");
        const frAlt = (p.altByLang["fr"] || []).join("; ");
        const ptAlt = (p.altByLang["pt"] || []).join("; ");
        // Latin altLabels are scientific synonyms per data model
        const synHtml = (p.altByLang["la"] || []).join("; ") || null;

        // Resolve named-node sources via conceptLabels or dcterms:bibliographicCitation
        const DCT_BIB = "http://purl.org/dc/terms/bibliographicCitation";
        const resolvedSources = p.sourceUris.map(uri => {
          const bibRec = bySubject.get(uri);
          if (bibRec) {
            // Try dcterms:bibliographicCitation stored as literal source on bib node
            if (bibRec.source && bibRec.source.length) return bibRec.source[0];
          }
          // Fall back to skos:prefLabel on the bib node
          const m = conceptLabels.get(uri);
          if (m) {
            const chosen = pickByLang(m, pageLang);
            if (chosen.length) return chosen[0];
          }
          return uri.split("/").pop();
        });
        const allSources = p.source.concat(resolvedSources);
        const source = allSources.length ? allSources.join("<br>") : "—";

        const access = p.access.length ? p.access.map(u => labelize(u, pageLang)).join(", ") : "—";
        const med = p.medicinal.length ? p.medicinal.map(u => labelize(u, pageLang)).join(", ") : "—";
        const rit = p.ritual.length ? p.ritual.map(u => labelize(u, pageLang)).join(", ") : "—";

        const collisionNotes = pickByLang(p.collisionNoteByLang, pageLang);
        const collisionHtml = collisionNotes.length ? collisionNotes.map(t => `<li>${t}</li>`).join("") : "";

        const ritualNotes = pickByLang(p.ritualNoteByLang, pageLang);
        const ritualHtml = ritualNotes.length ? ritualNotes.map(t => `<li>${t}</li>`).join("") : "";

        // source already resolved above via allSources

        const links = p.links
          .filter(x => typeof x === "string" && (x.startsWith("http://") || x.startsWith("https://")));
        const linkHtml = links.length
          ? links.map(u => `<a href="${u}" target="_blank" rel="noopener noreferrer">External record</a>`).join(" | ")
          : "—";

        const card = document.createElement("div");
        card.style.border = "1px solid rgba(48,64,32,0.18)";
        card.style.borderRadius = "12px";
        card.style.padding = "12px 14px";
        card.style.margin = "12px 0";

        card.innerHTML = `
          <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div style="font-weight:700;">${p.sci || "No scientific name"}</div>
            <div style="opacity:.75; font-size:.92rem;">${p.id || p.uri.split("/").pop()}</div>
          </div>
          ${synHtml ? `<div style="opacity:.7; font-size:.9rem; font-style:italic; margin-top:2px;"><strong>Syn:</strong> ${synHtml}</div>` : ""}

          <div style="margin-top:6px; opacity:.9;"><strong>Yorùbá:</strong> ${yo}</div>
          <div style="opacity:.85;"><strong>English:</strong> ${enAlt}</div>
          ${esCuAlt ? `<div style="opacity:.85;"><strong>Cuba (ES):</strong> ${esCuAlt}</div>` : esAlt ? `<div style="opacity:.85;"><strong>Español:</strong> ${esAlt}</div>` : ""}
          ${ptAlt ? `<div style="opacity:.85;"><strong>Português:</strong> ${ptAlt}</div>` : ""}
          ${frAlt ? `<div style="opacity:.85;"><strong>Français:</strong> ${frAlt}</div>` : ""}
          ${htAlt ? `<div style="opacity:.85;"><strong>Kreyòl ayisyen:</strong> ${htAlt}</div>` : ""}
          ${lucumiAlt ? `<div style="opacity:.85;"><strong>Lucumí:</strong> ${lucumiAlt}</div>` : ""}
          ${laAlt ? `<div style="opacity:.85;"><strong>Latin:</strong> ${laAlt}</div>` : ""}

          ${collisionHtml ? `
          <div style="margin-top:8px;">
            <strong>Name collision:</strong>
            <ul style="margin-top:4px;">${collisionHtml}</ul>
          </div>` : ""}

          <div style="margin-top:8px; opacity:.85;">
            <strong>Access:</strong> ${access}<br>
            <strong>Medicinal:</strong> ${med}<br>
            <strong>Ritual:</strong> ${rit}
          </div>

          ${ritualHtml ? `
          <div style="margin-top:6px;">
            <strong>Ritual context note:</strong>
            <ul style="margin-top:4px;">${ritualHtml}</ul>
          </div>` : ""}

          <div style="margin-top:8px; opacity:.85;">
            <strong>Source:</strong> ${source}<br>
            <strong>Links:</strong> ${linkHtml}
          </div>

          <div style="opacity:.65; font-size:.9rem; margin-top:8px;">${p.uri}</div>
        `;

        listEl.appendChild(card);
      }

    } catch (err) {
      if (statusEl) statusEl.textContent = "Error loading RDF graph.";
      if (listEl) listEl.innerHTML = "<p><em>" + err.message + "</em></p>";
      console.error(err);
    }
  }

  window.addEventListener("DOMContentLoaded", loadPlantsGraph);
</script>



</body>
</html>
